<?php include_once("../php/cn.php"); header("Access-Control-Allow-Origin:".AllowOriginAccess);header("Content-Type: text/html; charset=UTF-8");  ?><nav class="containerx"  ng-if="CURPAGE==0"> <a target="_blank"  ng-href="export/pdf/ventes/{{excercice}}&m={{mois}}&t={{extra.type}}" class="buttons buttonsss bgm-red  bg" tooltipss="PDF"><i class="zmdi zmdi-pdf "></i></a><a target="_blank" ng-href="export/excel/ventes/{{excercice}}&m={{mois}}&t={{extra.type}}" class="buttons buttonsss bgm-color1 bg" tooltipss="EXCEL"><i class="zmdi zmdi-excel "></i></a><a target="_blank" ng-href="export/office/ventes/{{excercice}}&m={{mois}}&t={{extra.type}}" class="buttons buttonsss bgm-color1 bg" tooltipss="WORD"><i class="zmdi zmdi-word "></i></a><a class="buttons  bgm-color2 bg " tooltipss="Imprimer" href="#"><i class="zmdi zmdi-print "></i></a></nav><button ng-if="CURPAGE!=0" class="bgm-blue btn btn-float m-btn visible-xs" ng-click="cancellx()" style="left: 10px;" ><i class="zmdi zmdi-reply"></i></button><div class="container p-t-30 o-hidden"><div class="smallloading" ng-if="LoaDing"></div>	<div role="tabpanel" class="tab">		<div class="tab-content p-0 " >			<div role="tabpanel" class="tab-pane animated  slideIn{{class}} "  ng-class="{'active':CURPAGE==0}">				<div class="card">					<div class="listview  lv-lg"><div class="lv-header-alt clearfix " ng-show="CURPAGE==0"><h2 class="lvh-label"><div ng-if="!MULTIPLE || selectedRowsIndexes.length==0" >  <i class="zmdi zmdi- m-r-10"></i> Ventes ({{TOTALITEMS}})</div><ng-pluralize ng-if="MULTIPLE && selectedRowsIndexes.length>0" count="selectedRowsIndexes.length" when="{'0': 'Zéro ligne sélectionnée.','one': 'Une ligne sélectionnée .','other': '{} lignes sélectionnées.'}" ></ng-pluralize></h2><div class="lvh-search" ng-show="listviewSearchStat"><i ng-click="listviewSearchStat = !listviewSearchStat" class="ah-search-close zmdi zmdi-long-arrow-left" ></i><input type="text" placeholder="Recherche dans la liste"  ng-keyup="$event.keyCode==27?listviewSearchStat =false:''" focus-me="listviewSearchStat" ng-model="serchfield"  class="lvhs-input" /><i class="lvh-search-close" ng-click="serchfield='';listviewSearchStat =false">&times;</i></div><ul class="lv-actions actions"><li tooltip-class="tooltip-blue" uib-tooltip="Recherche/بحث" > <a href="#" class="ah-search-trigger" ng-click="listviewSearchStat = true;CURPAGE=0;"> <i class="zmdi zmdi-search"></i> </a></li><li class="dropdown" uib-dropdown ng-if="selectedItem" ><a href="#" uib-dropdown-toggle><i class="zmdi zmdi-menu"></i></a><ul class="dropdown-menu dm-icon  m-l-10" ><li ><a  target="_blank" ng-href="export/pdf/facture/{{selectedItem.id}}"><i class="zmdi zmdi-pdf"></i>Télécharger Facture PDF </a></li><li ><a  target="_blank" ng-href="export/office/facture/{{selectedItem.id}}"><i class="zmdi zmdi-word"></i>Télécharger facture WORD </a></li><li ><a  target="_blank" ng-href="export/pdf/bl/{{selectedItem.id}}"><i class="zmdi zmdi-pdf"></i>Télécharger BL PDF </a></li><li ><a  target="_blank" ng-href="export/office/bl/{{selectedItem.id}}"><i class="zmdi zmdi-word"></i>Télécharger BL WORD </a></li><li  ng-if="selectedItem.id_cl"><a   target="_blank" ng-href="export/office/sn_clients/{{selectedItem.id_cl}}"><i class="zmdi zmdi-print"></i> Imprimer la synthèse du clients   </a></li><li ng-click="sendEmail(0)" ng-if="selectedItem.id_cl" ><a  href="#"><i class="zmdi zmdi-email"></i> Envoyer Facture par Mail (client)  </a></li><li ng-click="sendEmail(1)" ng-if="selectedItem.id_cl"><a  href="#"><i class="zmdi zmdi-mail"></i> Envoyer BL par Mail (client)  </a></li></ul></li><li tooltip-class="tooltip-blue" uib-tooltip="Supprimer"><a ng-class="!selectedItem && !MULTIPLE ?'opa3 ':''" ng-if="PERMISSON[2].value"  ng-click="delete()" href="#"><i class="zmdi zmdi-delete"></i></a></li><li tooltip-class="tooltip-blue" uib-tooltip="Annuler/إلغاء"><a ng-class="(CURPAGE==0 && (!selectedItem && !MULTIPLE))?'opa3 ':''"  ng-click="cancell();" href="#"><i class="zmdi zmdi-reply"></i></a></li><li tooltip-class="tooltip-blue" uib-tooltip="Informations/معلومات"><a ng-class="selectedItem==null?'opa3 ':''"  ng-click="infosAll()" href="#"><i class="zmdi zmdi-info_outline"></i></a></li><li tooltip-class="tooltip-blue" uib-tooltip="Ajouter/إضافة"><a  ng-click="add_ligne()" ng-if="PERMISSON[0].value" href="#"><i class="zmdi zmdi-plus"></i></a></li><li tooltip-class="tooltip-blue" uib-tooltip="Rafraîchir/تحديث"><a  ng-click="RELOAD(1)" href="#"><i class="zmdi zmdi-refresh"></i></a></li><li class="dropdown"   tooltip-class="tooltip-blue" uib-tooltip="Année"><select class="p-relative headertop"  ng-model="excercice" ng-change="RELOAD(1)"><?php for($i=date('Y');$i>=YEAR_START;$i--){echo "<option value='{$i}'>{$i}</option>";} ?></select></li>	<li class="dropdown" tooltip-class="tooltip-blue" uib-tooltip="Mois" ><select class="p-relative headertop"  ng-model="mois" ng-change="RELOAD(1)"><option value="-1">TOUS LES MOIS</option><?php foreach($MONTHS as $k=>$v){echo "<option value='{$k}'>{$v}</option>";} ?></select></li> <dh-paginate page-size="pageSize" ></dh-paginate></ul></div></div>				<table-directive ></table-directive>			</div>			</div>			<div role="tabpanel" class="tab-pane animated  zoomIn "  ng-class="{'active':CURPAGE==1}">			<button class="bgm-blue btn btn-float m-btn visible-xs" ng-click="save()"  style="right: 10px;"><i class="zmdi zmdi-check-all"></i></button>				<div class="row">					<div class="col-md-8"><div class="card"><div class="card-header p-10">					<div class="row">					<div class="col-md-4"><div class="checkbox" ng-if="!IS_MOBILE"><label><input  ng-model="LOCALCONFIG.printicket" ng-change="chsdz()" type="checkbox" value=""><i class="input-helper"></i>Imprimer ticket</label></div></div>					<div class="col-md-4"><div class="checkbox" ><label><input  ng-model="LOCALCONFIG.backToList" ng-change="chsdz()" type="checkbox" value=""><i class="input-helper"></i>Retour après validation</label></div></div>					<div class="col-md-4"><div class="checkbox" ><label><input  ng-model="LOCALCONFIG.AutoSelect" ng-change="chsdz()" type="checkbox" value=""><i class="input-helper"></i>Ajout Automatique</label></div></div>					</div>					</div>				<div class="row-padding p-t-20 formpadding">					<div class="col-12 col-md-4" >					<div class="form-group  has-feedback has-success" >					<label class="control-label" >Date Vente</label>					<div class="fg-line"  ><input ng-disabled="INFO" placeholder="Date Achat"  type="date" autocomplete="off"  class="form-control" ng-model="NEWITEM.date_vente" >					</div>					</div>					</div>					<div class="col-12  col-md-4" >					<div class="form-group  has-feedback has-success" >					<label class="control-label" >N° Facture</label>					<div class="fg-line"  ><input ng-disabled="INFO" type="text" autocomplete="off"  class="form-control" ng-model="NEWITEM.n_facture" >					</div>					</div>					</div></div><div class="row-padding clearfix ">					<div class="col-12 " ng-class="{'col-md-12':LOCALCONFIG.AutoSelect,'col-md-5':!LOCALCONFIG.AutoSelect}">					<angucomplete id="exlven1" showlabel="true"  placeholder="Recherche Produits " st="margin: 0px;" on-select="onSelect(result)"    title="Recherche Produits"  style="margin-top:0px"  pause="100" classx="b-0 getfocus" searchstr="txnshe"  url="php/filter?action=ventes&c="   minlength="1"  matchclass="highlighted" />					</div>					<div class="col-12  col-md-2" ng-hide="LOCALCONFIG.AutoSelect">					<div class="form-group  has-feedback has-success" >					<label class="control-label" >Quantité</label>					<div class="fg-line"  ><input type='number' ng-keyup="$event.keyCode==13?add_line():null"  ng-model-options="{debounce: 500}" min="0"  ng-disabled="INFO" step="1"  ng-model="TMP.q" ng-change="Q_change()" class="form-control b-0 qntt" placeholder="Quantité" />					</div>					</div>					</div>					<div class="col-12  col-md-2" ng-hide="LOCALCONFIG.AutoSelect">					<div class="form-group  has-feedback has-success" >					<label class="control-label" >Remise</label>					<div class="fg-line"  tooltip-class="tooltip-blue" uib-tooltip="Type de remise"><input type='number'  ng-keyup="$event.keyCode==13?add_line():null"  ng-model-options="{debounce: 500}" min="0" max="100"  ng-disabled="INFO" step="any"  ng-model="TMP.rm"  class="form-control b-0 pull-left" style="width: 40%;" placeholder="Remise" />					<div class="checkbox pull-right" ><label><input  ng-model="LOCALCONFIG.isper" ng-change="chsdz()" type="checkbox" value=""><i class="input-helper"></i>%</label></div>					</div>					</div>					</div>					<div class="col-12 col-md-3" ng-hide="LOCALCONFIG.AutoSelect">					<button class="btn btn-primary btn-icon-text p-0" ng-click="add_line()" style="width: 100%;height: 63px;font-size: 26px;"> Ajouter</button>					</div>					<div class="col-12 col-md-12" ng-show="TMP.id">					<p>Prix: <span class="badge">{{TMP.prix|currency:''}}</span>  					Q.Disp: <span class="badge">{{TMP.qt}}</span> D. péremption: <span class="badge">{{TMP.date_pre|date:'dd/MM/yyyy'}}</span> 					Remise: <span class="badge" ng-show="TMP.rm">{{LOCALCONFIG.isper?(((TMP.prix*TMP.rm)/100)|currency:'Dh'):(((TMP.rm/TMP.prix)* 100)|currency:'%')}}					</span>					Total : <span class="badge">{{TMP.prix*TMP.q|currency}}</span> 					</p>					</div></div><div style="margin-bottom:50px;overflow-x: auto;" class="clearfix m-t-10"><table style="width:100%" class=" tablex  table  teal  white" cellspacing="0"><tr><th><b>Produit</b></th><th><b>Quantite</b></th><th>Prix</th><th>Remise</th><th>TVA</th><th >Total</th><th><span class="f-20 zmdi zmdi-delete  c-blue"></span></th></tr><tr ng-repeat="x in NEWITEM.items"><td >{{x.name}}</td><td >{{x.q}}</td> <td >{{x.prix|currency:''}}</td><td >{{x.rm}}%</td><td >{{x.tva}}%</td><td >{{x.tt|currency:''}}</td><td ng-click="delet($index,x.xxx)" ><span class="zmdi zmdi-delete c-blue f-20"></span></td>	</tr></table></div><div class="clearfix"></div>  					</div>		</div>					<div class="col-md-4 ">						<div class="card">						<div class="card-header bgm-green"><h2>Responsable de la Vente <b>{{NEWITEM.cr}}</b><a  uib-tooltip="Annuler" class="p-absolute pull-right" style="    font-size: 34px;right: 14px;top: 11px;"   ng-click="cancellx();" href="#"><i class="zmdi zmdi-reply"></i></a></h2></div>							<div class="card-body p-10 c-white bgm-green moneyBg">								<p>Total à payer</p>								<p class="bigDigit">{{NEWITEM.total=(NEWITEM.items|totalr:'tt')|currency:''}}</p>								<p>Nombre de produits</p>								<p class="bigDigit">{{NEWITEM.items|totalr:'q'}}</p>								<div class="row">								<div class="col-12 col-sm-6">								<div class="form-group  has-feedback has-success" ng-hide="NEWITEM.id" >								<label><b>Mode Paiement</b> </label>								<div class="fg-line"  ><select ng-disabled="INFO" style="color: white;border: none;font-size: 23px;background: url(img/select.png) 99% no-repeat #ffffff00;"  ng-model="NEWITEM.mode_p" ng-change="popUpCheque()"   ><?php foreach(getModePay() as $k=>$v){echo "<option  value='{$k}'>{$v}</option>";}								?></select>								</div>								</div>								</div>								<div class="col-12 col-sm-6 col-md-6">								<button class="btn btn-link btn-icon-text c-white" ng-click="save()" style="width: 100%;height: 67px;font-size: 33px;background: transparent;font-weight: bold;"> Valider</button>								</div>								</div>							</div>						</div>						<div class="card" ng-if="NEWITEM.id">			<div class="card-header"><h2>Informations de traçabilité</h2></div>			<div class="card-body">				<ul class="list-group">                        <li class="list-group-item"><span class="badge">{{NEWITEM.dt_crt|timeAgo}}</span><span class="badge">{{NEWITEM.cr}}</span>Crée par</li>                        <li class="list-group-item"><span class="badge" >{{NEWITEM.dt_crt|date:'EEEE dd MMMM yyyy HH:mm:ss'}}</span>Crée le</li>						<li class="list-group-item"><span class="badge" ng-show="NEWITEM.up">{{NEWITEM.dt_update|timeAgo}}</span><span class="badge">{{NEWITEM.up}}</span></span>Mis à jour par</li>                        <li class="list-group-item"><span class="badge" ng-show="NEWITEM.up">{{NEWITEM.dt_update|date:'EEEE dd MMMM yyyy HH:mm:ss'}}</span>Mis à jour le</li>                      </ul>			</div>		</div>					</div>			</div>			</div>			<div role="tabpanel" class="tab-pane animated  slideIn{{class}} "  ng-class="{'active':CURPAGE==2}">				<div class="row">					<div class="col-md-8"><div class="card p-t-25 z-depth-1" style="background:#fbfbfb;"><div class="row" ><div class="pull-right col-sm-1 m-r-10" style="z-index: 2;">								<ul class="actions"><li class="dropdown" uib-dropdown >								<a href="#" uib-dropdown-toggle><i class="zmdi zmdi-print"></i></a><ul class="dropdown-menu dm-icon dropdown-menu-right m-l-10" >								<li ><a  target="_blank" ng-href="export/pdf/facture/{{INFOS.id}}&t=D"><i class="zmdi zmdi-download"></i>Télécharger PDF </a></li>								<li ng-if="!IS_MOBILE" ng-click="PrintPdf('PDF')"><a href="#"><i class="zmdi zmdi-pdf"></i>Imprimer PDF </a></li>								<li ><a  target="_blank" ng-href="export/office/facture/{{INFOS.id}}"><i class="zmdi zmdi-word"></i>Télécharger WORD </a></li>								<li ng-click="printticket()" ng-if="!IS_MOBILE"><a  href="#"><i class="zmdi zmdi-invoice"></i> Imprimer ticket de caisse  </a></li></ul></li></ul></div> 	 <div class="col-sm-6">		<ul>		<li><h2 class="m-t-0">N°  </h2>	<h2 style="font-size: 35px;"><b>{{INFOS.n_facture}}</b></h2></li>		<li>Gestionnaire : <b>{{INFOS.cr}}</b></li>		<li>Date de vente : <b>{{INFOS.date_vente|date:'dd/MM/yyyy'}}</b></li>	</ul>	</div>	<div class="col-sm-12" style="overflow-x: auto;">	<table style="margin-top: 40px;" class=" tablex  table card teal  m-b-0" cellspacing="0" width="100%"> <thead><tr><th>Produit</th><th>P.U d'origine</th><th>Remise</th><th>P.U</th><th>Quantité</th><th>TVA</th><th>TOTAL</th></tr></thead>	<tbody>	<tr ng-repeat="x in INFOS.data.items">	<td>{{x.name}}</td><td>{{x.prix|currency:''}}</td><td>{{x.rm}}%</td><td>{{x.rmx|currency:''}}</td><td>{{x.q}}</td><td>{{x.tva}}</td><td>{{(x.tt)|currency:''}}</td>	</tr>	<tfoot>	<tr><td colspan="3"></td><td colspan="2">Sous-total HT</td><td colspan="2">{{INFOS.CALC.ht|currency:''}}</td></tr>	<tr><td colspan="3"></td><td colspan="2">TVA</td><td colspan="2">{{INFOS.CALC.tva|currency:''}}</td></tr>	<tr><td colspan="3"></td><td colspan="2">Total remise</td><td colspan="2">{{INFOS.CALC.rm|currency:''}}</td></tr>	<tr><td colspan="3"></td><td colspan="2">TOTAL TTC</td><td colspan="2">{{INFOS.CALC.total|currency:''}}</td></tr>	</tfoot>	</tbody>	</table>	</div>	<div class="col-sm-6">		<ul>		<li>Crée par : <b>{{INFOS.cr}}</b></li>		<li>Crée le  : <b>{{INFOS.dt_crt|date:'EEEE dd MMMM yyyy HH:mm:ss'}}</b></li>		<li> <b><span class="badge" ng-show="INFOS.cr">{{INFOS.dt_crt|timeAgo}}</span></b></li>	</ul>	</div>	<div class="col-sm-6">		<ul><li>Mis à jour par : <b ng-if="INFOS.up">{{INFOS.up}}</b></li>		<li>Mis à jour le  : <b ng-if="INFOS.dt_update">{{INFOS.dt_update|date:'EEEE dd MMMM yyyy HH:mm:ss'}}</b></li>		<li><b><span class="badge" ng-show="INFOS.up">{{INFOS.dt_update|timeAgo}}</span></b></li>		</ul>	</div></div>					</div>												<div class="clearfix"></div></div>					<div class="col-md-4 ">						<div class="card">						<div class="card-header bgm-black" ><h2>Responsable de la Vente <b>{{INFOS.cr}}</b><a  uib-tooltip="Annuler" class="p-absolute pull-right" style="    font-size: 34px;right: 14px;top: 11px;"   ng-click="cancellx();" href="#"><i class="zmdi zmdi-reply"></i></a></h2></div>							<div class="card-body p-10 c-white moneyBg bgm-blue" >								<p>Total </p>								<p class="bigDigit">{{INFOS.CALC.total|currency:''}}</p>								<p>Nombre de produits</p>								<p class="bigDigit">{{INFOS.nbr}}</p>															</div>						</div>						</div>			</div>			</div>		</div>	</div></div>